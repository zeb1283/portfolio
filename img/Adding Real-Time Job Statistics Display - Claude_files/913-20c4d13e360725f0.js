"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[913],{70913:function(e,n,i){i.d(n,{Bo:function(){return U},KN:function(){return g},MH:function(){return A},Nt:function(){return w},QO:function(){return z},QU:function(){return f},Ux:function(){return m},Xg:function(){return y},Y:function(){return _},bN:function(){return p},fq:function(){return E},is:function(){return Q},kK:function(){return T},kS:function(){return M},oy:function(){return h},pV:function(){return C},vF:function(){return S}});var t=i(83041),u=i(16096),a=i(33062),r=i(78725),o=i(28648),l=i(35146),s=i(88337),c=i(84983),d=i(7653),v=i(83894);function m(e){let{onError:n}=e,{activeOrganization:i}=(0,u.useCurrentAccount)(),{data:a,variables:r,...o}=(0,t.uC)("/api/billing/".concat(null==i?void 0:i.uuid,"/consumer_pricing"),"POST",{enabled:!!i,meta:{noToast:!0},onError:n}),[l,s]=(0,d.useState)(),[c,v]=(0,d.useState)();return(0,d.useEffect)(()=>{a&&(s(a),v(r))},[a,r]),{data:l,variables:c,...o}}function f(e){let{onError:n}=e,{activeOrganization:i}=(0,u.useCurrentAccount)(),{data:a,variables:r,...o}=(0,t.uC)("/api/billing/".concat(null==i?void 0:i.uuid,"/cw_pricing"),"POST",{enabled:!!i,meta:{noToast:!0},onError:n}),[l,s]=(0,d.useState)(),[c,v]=(0,d.useState)();return(0,d.useEffect)(()=>{a&&(s(a),v(r))},[a,r]),{data:l,variables:c,...o}}let g=()=>{let{activeOrganization:e}=(0,u.useCurrentAccount)();return(0,t.uC)("/api/organizations/".concat(null==e?void 0:e.uuid,"/subscription"),"PUT",{enabled:!!e})},p=()=>{let{activeOrganization:e}=(0,u.useCurrentAccount)();return(0,t.uC)("/api/organizations/".concat(null==e?void 0:e.uuid,"/subscription/cw"),"PUT",{enabled:!!e})};function y(){let{activeOrganization:e}=(0,u.useCurrentAccount)();return(0,t.WE)("/api/organizations/".concat(null==e?void 0:e.uuid,"/subscription_details"),{queryKey:[l.QU,null==e?void 0:e.uuid],staleTime:0,enabled:!!e,meta:{noToast:e=>e instanceof o.Hx&&404===e.statusCode}})}function b(){let{activeOrganization:e}=(0,u.useCurrentAccount)(),n=(0,u.useHasRaven)();return(0,t.WE)("/api/organizations/".concat(null==e?void 0:e.uuid,"/subscription_status"),{queryKey:[l.sM,null==e?void 0:e.uuid],staleTime:0,enabled:!!e&&n,meta:{noToast:e=>e instanceof o.Hx&&404===e.statusCode}})}function C(){let{data:e,isLoading:n}=b();return{isRavenCanceled:(null==e?void 0:e.status)==="canceled"||(null==e?void 0:e.status)==="unpaid",isLoading:n}}function Q(){let{data:e,isLoading:n}=b();return{isRavenPastDue:(null==e?void 0:e.status)==="past_due",isLoading:n}}function _(){let{data:e,isLoading:n}=b();return{isRavenPendingCancellation:!!(null==e?void 0:e.cancel_at_ts),isLoading:n}}function T(){let{isRavenTrialing:e,isLoading:n}=function(){let{data:e,isLoading:n}=b();return{isRavenTrialing:(null==e?void 0:e.status)==="trialing",isLoading:n}}(),{isRavenCanceled:i,isLoading:t}=C(),{isRavenPastDue:u,isLoading:a}=Q(),{isRavenPendingCancellation:r,isLoading:o}=_(),{minimumApplied:l,isLoading:s}=z(),c=n||t||a||o||s;return{isLoading:c,canManageMembers:!c&&!i&&!u&&(e||!r||l)}}function U(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{activeOrganization:n}=(0,u.useCurrentAccount)(),i=(0,c.useQueryClient)(),a=null==n?void 0:n.uuid;return(0,t.uC)("/api/organizations/".concat(a,"/end_subscription"),"PUT",{...e,onSuccess(n,t,u){var r;i.setQueryData([l.QU,a],e=>{if(e)return{...e,plan_ending_before:"".concat(n.plan_ends_at,"T00:00:00+00:00")}}),i.invalidateQueries([l.sM,a]),i.invalidateQueries([l.je,a]),null===(r=e.onSuccess)||void 0===r||r.call(e,n,t,u)},enabled:!!n})}function h(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{activeOrganization:n}=(0,u.useCurrentAccount)(),i=(0,c.useQueryClient)(),a=null==n?void 0:n.uuid;return(0,t.uC)("/api/organizations/".concat(a,"/resume_subscription"),"PUT",{...e,onSuccess(n,t,u){var r;i.setQueryData([l.QU,a],e=>{if(e)return{...e,plan_ending_before:null}}),i.invalidateQueries([l.sM,a]),i.invalidateQueries([l.je,a]),null===(r=e.onSuccess)||void 0===r||r.call(e,n,t,u)},enabled:!!n})}function S(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{activeOrganization:n}=(0,u.useCurrentAccount)(),i=(0,c.useQueryClient)();return(0,t.uC)("/api/organizations/".concat(null==n?void 0:n.uuid,"/renew_subscription/cw"),"PUT",{...e,onSuccess(t,u,a){var r;i.invalidateQueries([l.QU,null==n?void 0:n.uuid]),i.invalidateQueries([l.sM,null==n?void 0:n.uuid]),i.invalidateQueries([l.RK,null==n?void 0:n.uuid]),i.invalidateQueries([l.je,null==n?void 0:n.uuid]),null===(r=e.onSuccess)||void 0===r||r.call(e,t,u,a)},enabled:!!n})}function A(e){let{limit:n,createdSince:i,organizationUUID:a,meta:r}=e,{activeOrganization:o}=(0,u.useCurrentAccount)(),s=Math.round(i.toSeconds()),c=a||(null==o?void 0:o.uuid);return(0,t.WE)("/api/stripe/".concat(c,"/invoices?limit=").concat(n,"&created_since_ts=").concat(s),{queryKey:[l.RK,c,{limit:n,created_since_ts:s}],staleTime:0,enabled:!!c,meta:r})}function w(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{activeOrganization:n}=(0,u.useCurrentAccount)(),i=(0,u.useHasRaven)();return(0,t.WE)("/api/stripe/".concat(null==n?void 0:n.uuid,"/upcoming_invoice"),{queryKey:[l.je,null==n?void 0:n.uuid],staleTime:0,enabled:!!n&&i,meta:{noToast:e=>e instanceof o.Hx&&500===e.statusCode},...e})}function M(){let{activeOrganization:e}=(0,u.useCurrentAccount)(),n=(0,c.useQueryClient)(),i=null==e?void 0:e.uuid;return(0,t.uC)("/api/organizations/".concat(i,"/payment_method/update_latest"),"POST",{onSuccess:async e=>{let t=n.getQueryData([l.QU,i]);t&&e?n.setQueryData([l.QU,i],{...t,payment_method:{...e}}):await n.invalidateQueries([l.QU,i]),n.invalidateQueries([l.sM,i]),n.invalidateQueries([l.RK,i])},meta:{noToast:!0}})}function z(){let{data:e,isLoading:n}=(0,r.uy)(),{data:i,isLoading:t}=(0,r.cK)(),o=(0,a.N)(s.YB.MembersManage),{data:l}=(0,v.aJ)(),c=(0,u.useIsEnterprise)(),d=n||t||!e||!i||!l;if(d)return{isLoading:d,hasManageMembersPermission:o,membersWithMinApplied:!1,activeMembers:0,invitedMembers:0,unclaimedMembers:0,minimumApplied:!1,memberLimit:0,isUnlimited:!1};let m=e.length,f=i.filter(e=>"pending"===e.status).length,g=m+f,p=c?l.members_limit-g:Math.max(5-g,0);return{isLoading:d,hasManageMembersPermission:o,totalMembersWithoutMinimumApplied:g,totalMembersWithMinimumApplied:Math.max(m+f,5),activeMembers:m,invitedMembers:f,unclaimedMembers:p,minimumApplied:g<5,memberLimit:l.members_limit,isUnlimited:l.unlimited_members||!1}}function E(){var e;let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{activeOrganization:i}=(0,u.useCurrentAccount)(),a="/api/organizations/".concat(null!==(e=null==i?void 0:i.uuid)&&void 0!==e?e:"","/profile"),r=(0,c.useQueryClient)();return(0,t.uC)(a,"PUT",{...n,async onSuccess(){for(var e,i=arguments.length,t=Array(i),u=0;u<i;u++)t[u]=arguments[u];await r.invalidateQueries([l.eo]),await (null===(e=n.onSuccess)||void 0===e?void 0:e.call(n,...t))}})}},83894:function(e,n,i){i.d(n,{$f:function(){return d},$r:function(){return o},CQ:function(){return l},KJ:function(){return c},aJ:function(){return s}});var t=i(83041),u=i(16096),a=i(35146),r=i(84983);let o=e=>(0,t.WE)("/api/organizations/".concat(e),{queryKey:[a.mm,e],enabled:!!e,staleTime:3e4}),l=()=>{let{activeOrganization:e}=(0,u.useCurrentAccount)(),n=null==e?void 0:e.uuid;return(0,t.Ne)(e=>{let{flagType:i}=e;return"/api/organizations/".concat(n,"/flags/").concat(i,"/dismiss")},"POST",(e,n)=>{let{flagType:i}=e;if(n)return{...n,active_flags:n.active_flags.filter(e=>e.type!==i)}},{queryKey:[a.mm,n]})},s=()=>{let{activeOrganization:e}=(0,u.useCurrentAccount)(),n=null==e?void 0:e.uuid;return(0,t.WE)("/api/organizations/".concat(n,"/members_limit"),{queryKey:[a.UD,n],enabled:!!n,staleTime:0})},c=()=>{let{activeOrganization:e}=(0,u.useCurrentAccount)(),n=null==e?void 0:e.uuid;return(0,t.WE)("/api/organizations/".concat(n,"/public_projects_enabled"),{queryKey:[a.eu,n],enabled:!!n,staleTime:0})};function d(){var e;let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{activeOrganization:i}=(0,u.useCurrentAccount)(),o="/api/organizations/".concat(null!==(e=null==i?void 0:i.uuid)&&void 0!==e?e:""),l=(0,r.useQueryClient)();return(0,t.uC)(o,"PUT",{enabled:!!i,...n,async onSuccess(){for(var e,i=arguments.length,t=Array(i),u=0;u<i;u++)t[u]=arguments[u];await Promise.all([l.invalidateQueries([a.aY]),l.invalidateQueries([a.mm])]),await (null===(e=n.onSuccess)||void 0===e?void 0:e.call(n,...t))}})}},33062:function(e,n,i){i.d(n,{N:function(){return r}});var t=i(88337),u=i(7653),a=i(16096);function r(e){let{account:n,activeOrganization:i}=(0,a.useCurrentAccount)();return(0,u.useMemo)(()=>(0,t.Di)(n,i,e),[n,i,e])}},78725:function(e,n,i){i.d(n,{DT:function(){return m},Iw:function(){return f},Qx:function(){return g},cK:function(){return d},er:function(){return v},gK:function(){return c},uy:function(){return s},wA:function(){return p}});var t=i(83041),u=i(16096),a=i(59374),r=i(28648),o=i(35146),l=i(84983);let s=()=>{var e;let{activeOrganization:n}=(0,u.useCurrentAccount)();return(0,t.WE)("/api/organizations/".concat(null!==(e=null==n?void 0:n.uuid)&&void 0!==e?e:"","/members"),{enabled:!!(null==n?void 0:n.uuid)&&(n.capabilities.includes("api")||n.capabilities.includes("raven")),queryKey:[o.I_,{orgUUID:null==n?void 0:n.uuid}],staleTime:0})},c=function(e){var n;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{activeOrganization:a}=(0,u.useCurrentAccount)(),r=(0,l.useQueryClient)();return(0,t.uC)("/api/organizations/".concat(null!==(n=null==a?void 0:a.uuid)&&void 0!==n?n:"","/members/").concat(e),"PUT",{...i,meta:{errorMessage:"There was an error updating the userâ€™s role."},async onSuccess(){for(var e,n=arguments.length,t=Array(n),u=0;u<n;u++)t[u]=arguments[u];await Promise.all([r.invalidateQueries([o.I_,{orgUUID:null==a?void 0:a.uuid}]),r.invalidateQueries([o.BB,{orgUUID:null==a?void 0:a.uuid}])]),await (null===(e=i.onSuccess)||void 0===e?void 0:e.call(i,...t))}})},d=()=>{var e;let{activeOrganization:n}=(0,u.useCurrentAccount)();return(0,t.WE)("/api/organizations/".concat(null!==(e=null==n?void 0:n.uuid)&&void 0!==e?e:"","/invites"),{enabled:!!(null==n?void 0:n.uuid)&&(n.capabilities.includes("api")||n.capabilities.includes("raven")),queryKey:[o.BB,{orgUUID:null==n?void 0:n.uuid}],staleTime:0})},v=function(e,n,i){let u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=(0,l.useQueryClient)(),{addError:c}=(0,a.useToasts)(),d="uuid"in n?n.uuid:n.account.uuid,v="email_address"in n?n.email_address:n.account.email_address;return(0,t.uC)("/api/organizations/".concat(e,"/").concat(i?"workspaces/".concat(i,"/"):"","members/").concat(d),"DELETE",{...u,meta:{noToast:!0},async onSuccess(){for(var n,t=arguments.length,a=Array(t),r=0;r<t;r++)a[r]=arguments[r];i?await s.invalidateQueries([o.Nw,{orgUUID:e,workspaceId:i}]):(await s.invalidateQueries([o.I_,{orgUUID:e}]),s.invalidateQueries([o.je,e]),s.invalidateQueries([o.sM,e])),await (null===(n=u.onSuccess)||void 0===n?void 0:n.call(u,...a))},onError(e){var n,i;e instanceof r.Hx&&(null===(i=e.extra)||void 0===i?void 0:null===(n=i.details)||void 0===n?void 0:n.type)==="seat_minimum_reached"?c("You cannot go below 5 members."):c("There was an error removing ".concat(v," from the organization."))}})},m=function(e,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},u=(0,l.useQueryClient)(),{addError:s}=(0,a.useToasts)();return(0,t.uC)("/api/organizations/".concat(e,"/invites/").concat(n),"DELETE",{...i,meta:{noToast:!0},async onSuccess(){for(var n,t=arguments.length,a=Array(t),r=0;r<t;r++)a[r]=arguments[r];await u.invalidateQueries([o.BB,{orgUUID:e}]),u.invalidateQueries([o.je,e]),u.invalidateQueries([o.sM,e]),await (null===(n=i.onSuccess)||void 0===n?void 0:n.call(i,...a))},onError(e){var n,i;e instanceof r.Hx&&(null===(i=e.extra)||void 0===i?void 0:null===(n=i.details)||void 0===n?void 0:n.type)==="seat_minimum_reached"?s("You cannot go below 5 members."):s("There was an error revoking the invite.")}})},f=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=(0,l.useQueryClient)();return(0,t.uC)("/api/organizations/".concat(e,"/invites"),"POST",{...n,async onSuccess(){for(var t,u=arguments.length,a=Array(u),r=0;r<u;r++)a[r]=arguments[r];await i.invalidateQueries([o.BB,{orgUUID:e}]),i.invalidateQueries([o.je,e]),i.invalidateQueries([o.sM,e]),await (null===(t=n.onSuccess)||void 0===t?void 0:t.call(n,...a))}})},g=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=(0,l.useQueryClient)();return(0,t.uC)("/api/organizations/".concat(e,"/invites/bulk"),"POST",{...n,async onSuccess(){for(var t,u=arguments.length,a=Array(u),r=0;r<u;r++)a[r]=arguments[r];await i.invalidateQueries([o.BB,{orgUUID:e}]),i.invalidateQueries([o.je,e]),i.invalidateQueries([o.sM,e]),await (null===(t=n.onSuccess)||void 0===t?void 0:t.call(n,...a))}})},p=function(e,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},u=(0,l.useQueryClient)();return(0,t.uC)("/api/organizations/".concat(e,"/invites/").concat(n),"PUT",{...i,async onSuccess(){for(var n,t=arguments.length,a=Array(t),r=0;r<t;r++)a[r]=arguments[r];await u.invalidateQueries([o.BB,{orgUUID:e}]),await (null===(n=i.onSuccess)||void 0===n?void 0:n.call(i,...a))}})}}}]);