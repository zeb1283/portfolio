"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5432],{34077:function(e,t,n){n.d(t,{FO:function(){return R},N7:function(){return z},O3:function(){return f},P2:function(){return g},TD:function(){return y},Wy:function(){return q},q2:function(){return b},to:function(){return r},vr:function(){return p}});var s,r,o=n(64507),a=n(68444),i=n(40350);(s=r||(r={})).ReadyForContent="anthropic.claude.usercontent.sandbox.ReadyForContent",s.SetContent="anthropic.claude.usercontent.sandbox.SetContent",s.GetFile="anthropic.claude.usercontent.sandbox.GetFile",s.SendConversationMessage="anthropic.claude.usercontent.sandbox.SendConversationMessage",s.RunCode="anthropic.claude.usercontent.sandbox.RunCode",s.ClaudeCompletion="anthropic.claude.usercontent.sandbox.ClaudeCompletion",s.ReportError="anthropic.claude.usercontent.sandbox.ReportError";let c=a.z.object({type:a.z.literal("UnsupportedImports"),unsupportedModules:a.z.array(a.z.string()),nonExistentIcons:a.z.array(a.z.string())}),u=a.z.object({type:a.z.literal("RuntimeError"),message:a.z.string()}),d=a.z.object({type:a.z.literal("FileNotFound"),fileName:a.z.string()}),l=a.z.object({type:a.z.literal("ClaudeCompletionError"),message:a.z.string()}),h=a.z.discriminatedUnion("type",[c,u,d,l]);a.z.object({code:a.z.string()});let p=a.z.object({status:a.z.enum(["success","error"]),result:a.z.string().optional(),logs:a.z.array(a.z.string()),error:a.z.string().optional()}),m={"anthropic.claude.usercontent.sandbox.SetContent":{requestSchema:i.Zq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.SetContent"),payload:a.z.strictObject({"@type":a.z.literal("anthropic.claude.usercontent.sandbox.SandboxContent"),content:a.z.string(),type:a.z.nativeEnum(o.JP)})}),responseSchema:i.AY,alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.ReadyForContent":{requestSchema:i.Zq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.ReadyForContent"),payload:a.z.strictObject({"@type":a.z.literal("google.protobuf.Empty")})}),responseSchema:i.AY,alwaysPermitted:!0},"anthropic.claude.usercontent.sandbox.GetFile":{requestSchema:i.Zq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.GetFile"),payload:a.z.strictObject({key:a.z.string(),"@type":a.z.literal("anthropic.claude.usercontent.sandbox.GetFileRequest")})}),responseSchema:i.Tk.extend({payload:a.z.strictObject({value:a.z.instanceof(Uint8Array).nullable(),"@type":a.z.literal("anthropic.claude.usercontent.sandbox.GetFileResponse")})}),alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.SendConversationMessage":{requestSchema:i.Zq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.SendConversationMessage"),payload:a.z.strictObject({message:a.z.string(),messageType:a.z.enum(["text","error"]),"@type":a.z.literal("anthropic.claude.usercontent.sandbox.SendConversationMessageRequest")})}),responseSchema:i.AY,alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.RunCode":{requestSchema:i.Zq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.RunCode"),payload:a.z.strictObject({code:a.z.string(),"@type":a.z.literal("anthropic.claude.usercontent.sandbox.RunCodeRequest")})}),responseSchema:i.Tk.extend({payload:a.z.strictObject({"@type":a.z.literal("anthropic.claude.usercontent.sandbox.RunCodeResponse")}).merge(p)}),alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.ClaudeCompletion":{requestSchema:i.Zq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.ClaudeCompletion"),payload:a.z.strictObject({prompt:a.z.string(),"@type":a.z.literal("anthropic.claude.usercontent.sandbox.ClaudeCompletionRequest")})}),responseSchema:i.Tk.extend({payload:a.z.strictObject({completion:a.z.string().nullable(),"@type":a.z.literal("anthropic.claude.usercontent.sandbox.ClaudeCompletionResponse")})}),alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.ReportError":{requestSchema:i.Zq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.ReportError"),payload:a.z.strictObject({"@type":a.z.literal("anthropic.claude.usercontent.sandbox.ReportErrorRequest"),error:h})}),responseSchema:i.AY,alwaysPermitted:!0}},g=a.z.enum(["anthropic.claude.usercontent.sandbox.ReadyForContent","anthropic.claude.usercontent.sandbox.GetFile","anthropic.claude.usercontent.sandbox.SendConversationMessage","anthropic.claude.usercontent.sandbox.ClaudeCompletion","anthropic.claude.usercontent.sandbox.ReportError"]),b=a.z.discriminatedUnion("method",[m["anthropic.claude.usercontent.sandbox.ReadyForContent"].requestSchema,m["anthropic.claude.usercontent.sandbox.GetFile"].requestSchema,m["anthropic.claude.usercontent.sandbox.SendConversationMessage"].requestSchema,m["anthropic.claude.usercontent.sandbox.ClaudeCompletion"].requestSchema,m["anthropic.claude.usercontent.sandbox.ReportError"].requestSchema]),R=a.z.union([i.AY,m["anthropic.claude.usercontent.sandbox.GetFile"].responseSchema,m["anthropic.claude.usercontent.sandbox.SendConversationMessage"].responseSchema,m["anthropic.claude.usercontent.sandbox.ClaudeCompletion"].responseSchema]),q=a.z.enum(["anthropic.claude.usercontent.sandbox.SetContent","anthropic.claude.usercontent.sandbox.RunCode"]),z=a.z.discriminatedUnion("method",[m["anthropic.claude.usercontent.sandbox.SetContent"].requestSchema,m["anthropic.claude.usercontent.sandbox.RunCode"].requestSchema]),f=a.z.union([m["anthropic.claude.usercontent.sandbox.SetContent"].responseSchema,m["anthropic.claude.usercontent.sandbox.RunCode"].responseSchema]),y=Object.entries(m).filter(e=>{let[t,n]=e;return!0===n.alwaysPermitted}).map(e=>{let[t,n]=e;return t})},40350:function(e,t,n){n.d(t,{AY:function(){return c},D7:function(){return u},Kj:function(){return i},Tk:function(){return a},Zq:function(){return o},qV:function(){return r},v8:function(){return d}});var s=n(68444);let r=s.z.object({channel:s.z.enum(["request","response"]),requestId:s.z.string()}).passthrough(),o=r.strict().extend({channel:s.z.literal("request"),method:s.z.string(),payload:s.z.strictObject({"@type":s.z.string()})}),a=r.extend({channel:s.z.literal("response"),status:s.z.number().int().min(100).max(599),payload:s.z.strictObject({"@type":s.z.string()}).passthrough()}).passthrough(),i=a.extend({status:s.z.number().int().min(400).max(599),payload:s.z.strictObject({"@type":s.z.literal("anthropic.claude.usercontent.ErrorResponse"),error:s.z.string()})}),c=a.extend({payload:s.z.strictObject({"@type":s.z.literal("google.protobuf.Empty")})}),u={"@type":"google.protobuf.Empty"},d=e=>({"@type":"anthropic.claude.usercontent.ErrorResponse",error:e})},15432:function(e,t,n){n.d(t,{A:function(){return a},i:function(){return o}});var s=n(34077),r=n(40350);class o{setupMessageListener(){window.addEventListener("message",this.boundHandleMessage,!1)}handleMessage(e){if(e.origin!==this.allowedOrigin||e.source!==this.iframe.contentWindow)return;let t=Date.now();if(t-this.lastResetTime>this.RESET_INTERVAL&&(this.messageCount=0,this.lastResetTime=t),this.messageCount++,this.messageCount>this.MAX_MESSAGES_PER_INTERVAL){window.removeEventListener("message",this.boundHandleMessage),this.onRateLimited&&this.onRateLimited();return}let n=r.qV.safeParse(e.data);if(!n.success){console.warn("Received message does not conform to basic message shape, ignoring");return}let s=n.data;if("response"===s.channel){this.handleResponse(s);return}this.messageQueue.push(s),this.isConsumerRunning||this.consumeMessages()}handleResponse(e){let t=this.inFlightRequests.get(e.requestId);if(void 0!==t){t(e);return}}async consumeMessages(){for(this.isConsumerRunning=!0;this.messageQueue.length>0;){let e=this.messageQueue.shift();if(!e)continue;let t=s.P2.safeParse(e.method);if(!t.success){this.sendErrorResponse(e.requestId,400,"Unknown method");continue}let n=t.data,o=s.q2.safeParse(e);if(!o.success){this.sendErrorResponse(e.requestId,400,"Invalid payload content");continue}let a=o.data;if(this.requestLog.has(a.requestId)){this.sendErrorResponse(a.requestId,400,"Request ID already processed");continue}this.requestLog.set(a.requestId,{message:a,requestTimestamp:new Date().getTime()}),await this.onPermissionRequested(n).then(e=>"denied"!==e||(this.sendErrorResponse(a.requestId,403,"Permission denied"),!1)).catch(e=>(console.error("Error checking permission for method ".concat(n,":"),e),this.sendErrorResponse(a.requestId,500,"Error checking permission"),!1))&&(this.onCapabilityAction(a,this.boundSendRequest).then(e=>{var t;let n=r.Tk.parse({channel:"response",status:200,requestId:a.requestId,payload:null!=e?e:r.D7}),s=this.requestLog.get(a.requestId);s&&this.requestLog.set(a.requestId,{...s,response:n,responseTimestamp:new Date().getTime()}),null===(t=this.iframe.contentWindow)||void 0===t||t.postMessage(n,this.allowedOrigin)}).catch(e=>{console.error("Error processing action for method ".concat(n,":"),e),this.sendErrorResponse(a.requestId,500,"Internal server error while processing action")}),await new Promise(e=>requestAnimationFrame(e)))}this.isConsumerRunning=!1}sendErrorResponse(e,t,n){var s;let o=r.Kj.parse({channel:"response",status:t,requestId:e,payload:(0,r.v8)(n)}),a=this.requestLog.get(e);a&&this.requestLog.set(e,{...a,response:o,responseTimestamp:new Date().getTime()}),null===(s=this.iframe.contentWindow)||void 0===s||s.postMessage(o,this.allowedOrigin)}restartListening(){window.removeEventListener("message",this.boundHandleMessage),this.messageCount=0,this.lastResetTime=Date.now(),this.setupMessageListener()}cleanup(){window.removeEventListener("message",this.boundHandleMessage),this.messageQueue=[],this.isConsumerRunning=!1,this.inFlightRequests.clear()}async sendRequest(e,t){return new Promise((n,o)=>{var a;let i=Date.now().toString();this.inFlightRequests.set(i,e=>{let t=r.Tk.safeParse(e);if(!t.success){o(Error("Invalid response format"));return}let a=t.data;if(a.status>=400){let e=r.Kj.safeParse(a);e.success?o(Error(e.data.payload.error)):o(Error("Error response (".concat(a.status,")")));return}let i=s.O3.safeParse(a);i.success?n(i.data.payload):o(Error("Invalid response payload for the method"))}),null===(a=this.iframe.contentWindow)||void 0===a||a.postMessage({channel:"request",method:e,requestId:i,payload:t},this.allowedOrigin)})}getRequestLog(){return Array.from(this.requestLog.entries()).map(e=>{let[t,n]=e;return{...n,requestId:t}}).sort((e,t)=>t.requestTimestamp-e.requestTimestamp)}constructor({iframe:e,allowedOrigin:t,onRateLimited:n=null,onPermissionRequested:s,onCapabilityAction:r}){this.messageCount=0,this.lastResetTime=Date.now(),this.MAX_MESSAGES_PER_INTERVAL=30,this.RESET_INTERVAL=5e3,this.onRateLimited=null,this.messageQueue=[],this.isConsumerRunning=!1,this.requestLog=new Map,this.inFlightRequests=new Map,this.iframe=e,this.allowedOrigin=t,this.onRateLimited=n,this.onPermissionRequested=s,this.onCapabilityAction=r,this.boundHandleMessage=this.handleMessage.bind(this),this.boundSendRequest=this.sendRequest.bind(this),this.setupMessageListener()}}class a{setupMessageListener(){window.addEventListener("message",this.boundHandleMessage,!1)}handleMessage(e){if(!1===this.allowedOrigins.includes(e.origin)||e.source!==this.parentWindow)return;let t=r.qV.safeParse(e.data);if(!t.success){console.warn("Received message does not conform to basic request shape, ignoring");return}let n=t.data;if("response"===n.channel){this.handleResponse(n);return}if(!s.Wy.safeParse(n.method).success){this.sendErrorResponse(n.requestId,400,"Unknown method");return}let o=s.N7.safeParse(n);if(!o.success){this.sendErrorResponse(n.requestId,400,"Invalid payload content");return}let a=o.data;this.onOutsideRequest(a).then(e=>{let t=r.Tk.parse({channel:"response",status:200,requestId:a.requestId,payload:null!=e?e:r.D7});this.sendMessage(t)}).catch(e=>{console.error("Error processing action for method ".concat(a.method,":"),e),this.sendErrorResponse(a.requestId,500,"Internal error while processing action")})}sendErrorResponse(e,t,n){let s=r.Kj.parse({channel:"response",status:t,requestId:e,payload:(0,r.v8)(n)});this.sendMessage(s)}sendMessage(e){this.allowedOrigins.forEach(t=>{this.parentWindow.postMessage(e,t)})}cleanup(){window.removeEventListener("message",this.boundHandleMessage),this.inFlightRequests.clear()}handleResponse(e){let t=this.inFlightRequests.get(e.requestId);if(void 0!==t){t(e);return}}async sendRequest(e,t){return new Promise((n,o)=>{let a=Date.now().toString()+Math.random().toString();this.inFlightRequests.set(a,e=>{let t=r.Tk.safeParse(e);if(!t.success){o(Error("Invalid response format"));return}let a=t.data;if(a.status>=400){let e=r.Kj.safeParse(a);e.success?o(Error(e.data.payload.error)):o(Error("Error response (".concat(a.status,")")));return}let i=s.FO.safeParse(a);i.success?n(i.data.payload):o(Error("Invalid response payload for the method"))}),this.sendMessage({channel:"request",method:e,requestId:a,payload:t})})}constructor({parentWindow:e,allowedOrigins:t,onOutsideRequest:n}){this.inFlightRequests=new Map,this.parentWindow=e,this.allowedOrigins=t,this.onOutsideRequest=n,this.boundHandleMessage=this.handleMessage.bind(this),this.setupMessageListener()}}},64507:function(e,t,n){var s,r,o;n.d(t,{JP:function(){return s},KD:function(){return r}}),(o=s||(s={})).Text="text/plain",o.Markdown="text/markdown",o.Html="text/html",o.Code="application/vnd.ant.code",o.Svg="image/svg+xml",o.Mermaid="application/vnd.ant.mermaid",o.React="application/vnd.ant.react",(r||(r={})).Repl="application/vnd.ant.repl";let a="antArtifact",i="<".concat(a,"(?:\\s+([^>]*)>|(?!>)\\S*)"),c="</".concat(a,">");RegExp("".concat(i,"([\\s\\S]*?)(?:").concat(c,"|$)"),"g"),RegExp("".concat(i,"[\\s\\S]*?(?:").concat(c,"|$)"),"g");let u="antThinking",d="<".concat(u,">");RegExp("".concat(d,"[\\s\\S]*?(?:</").concat(u,">|$)"),"g")}}]);